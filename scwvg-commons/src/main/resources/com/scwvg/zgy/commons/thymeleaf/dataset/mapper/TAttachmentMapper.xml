<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--
namespace 命名空间，为了对sql语句进行隔离，方便管理,
namespace 命名空间, 路径全限定名
 -->
<mapper namespace="com.scwvg.zgy.commons.thymeleaf.dataset.mapper.TAttachmentMapper">


    <!-- 1. 向数据库保存附件 -->
    <insert id="insert"
            parameterType="com.scwvg.zgy.commons.thymeleaf.dataset.TAttachment">
        <!-- mySQL返回主键id -->
        <selectKey keyProperty="fileId"
                   order="AFTER"
                   resultType="Double">
            SELECT LAST_INSERT_ID()
        </selectKey>
      <![CDATA[
        INSERT INTO t_attachment (
            /*文件编号*/
            file_id,
            /*显示名称*/
            file_name,
            /*大小*/
            file_size,
            /*真实名称*/
            file_reale_name,
            /*文件路径*/
            file_path,
            /*后缀*/
            suffix,
            /*上传者*/
            create_user,
            /*修改者*/
            update_user,
            /*上传时间*/
            create_date,
            /*修改时间*/
            update_date
        )
        VALUES
            (
                #{ta.fileId},
                #{ta.fileName},
                #{ta.fileSize},
                #{ta.fileRealeName},
                #{ta.filePath},
                #{ta.suffix},
                #{ta.createUser},
                #{ta.updateUser},
                #{ta.createDate},
                #{ta.updateDate}
            )
      ]]>
    </insert>
    <!-- //向数据库保存附件 -->
    <!-- 2. 根据文件id检索附件 -->
    <select id="findByFileIdsIn"
            parameterType="java.util.HashMap"
            resultType="com.scwvg.zgy.commons.thymeleaf.dataset.TAttachment">
           <![CDATA[
            SELECT
                /*文件编号*/
                b.file_id AS "fileId",
                /*显示名称*/
                b.file_name AS "fileName",
                /*大小*/
                b.file_size AS "fileSize",
                /*真实名称*/
                b.file_reale_name AS "fileRealeName",
                /*文件路径*/
                b.file_path AS "filePath",
                /*后缀*/
                b.suffix AS "suffix",
                /*上传者*/
                b.create_user AS "createUser",
                /*修改者*/
                b.update_user AS "updateUser",
                /*上传时间*/
                b.create_date AS "createDate",
                /*修改时间*/
                b.update_date AS "updateDate"
            FROM
                t_attachment b
            WHERE
                1 = 1
          ]]>
        <if test="fileIds != null">
            AND b.file_id IN
            <foreach collection="fileIds" item="fileId" index="index" open="(" close=")" separator=",">
                #{fileId}
            </foreach>
        </if>
    </select>
    <!-- //根据文件id检索附件 -->
</mapper>