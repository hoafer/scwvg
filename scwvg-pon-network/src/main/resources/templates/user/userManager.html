<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">
<head>
    <meta charset="UTF-8">
    <title>用户管理</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="stylesheet" href="../../../static/layui/css/layui.css" th:href="@{/layui/css/layui.css}" media="all">
    <link rel="stylesheet" href="../../../static/style/admin.css" th:href="@{/style/admin.css}" media="all">
</head>
<body>
<div class="layui-fluid">
    <div class="layui-card">
        <!--header头部-->
        <div class="layui-form layui-card-header layuiadmin-card-header-auto">
            <div class="layui-form-item">
                <!--开始编写查询条件内如-->
                <div class="layui-inline">
                    <label class="layui-form-label">登录账号</label>
                    <div class="layui-input-block">
                        <input class="layui-input" type="text" name="wvg_login_name" placeholder="登录用户名" autocomplete="off">
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">真实姓名</label>
                    <div class="layui-input-block">
                        <input class="layui-input" type="text" name="wvg_real_name" placeholder="真实姓名" autocomplete="off">
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">电话号码</label>
                    <div class="layui-input-block">
                        <input class="layui-input" type="text" name="wvg_user_ihpone" placeholder="手机号码" autocomplete="off">
                    </div>
                </div>
                <div class="layui-inline">
                    <button class="layui-btn layuiadmin-btn-useradmin" lay-submit lay-filter="LAY-user-front-search">
                        <i class="layui-icon layui-icon-search layuiadmin-button-btn"></i>
                    </button>
                    <button class="layui-btn layuiadmin-btn-useradmin" id="adduser" data-type="add" permission="users:add">添加</button>
                </div>
            </div>
        </div>
        <!--body中间-->
        <div class="layui-card-body">
            <table id="LAY-user-manage" lay-filter="LAY-user-manage"></table>
            <script type="text/html" id="operation">
                <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail" permission="users:quit">踢下线</a>
                <a class="layui-btn layui-btn-xs" lay-event="edit" permission="users:update">编辑</a>
                <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del" permission="users:del">删除</a>
            </script>
        </div>
    </div>
</div>
<script src="../static/layui/layui.js" th:src="@{/layui/layui.js}"></script>
<script type="text/javascript" src="../../js/jquery-2.1.1.min.js"></script>
<script type="text/javascript" src="../../js/jq.js"></script>
<script th:inline="none">
    var token=localStorage.getItem("token");
    layui.config({
        base:"/"
    }).extend({
        index: 'lib/index'
    }).use(['index','table','laydate'], function () {
        var table = layui.table;
        var form = layui.form;
        var laydate = layui.laydate;
        /*设置表头，获取数据*/
        table.render({
            elem: '#LAY-user-manage',
            //二维数组表头,详见layui官方文档
            cols:[[ {field: 'wvg_login_name', title: '登录名', width: 80},
                {field: 'wvg_real_name', title: '真实姓名', width: 120},
                {field: 'wvg_id_type', title: '身份类型', width: 120},
                {field: 'changeStr3', title: '用户属地', width: 120},
                {field: 'changeStr', title: '用户专业', width: 80},
                {field: 'wvg_id_number', title: '身份证号', width: 120},
                {field: 'wvg_user_iphone', title: '手机号', width: 160},
                {field: 'changeStr1', title: '账号在线状态', width: 160},
                {field: 'changeStr2', title: '是否启用', width: 160},
                {field: 'wvg_account_data', title: '账号有效期', width: 160},
                {field: 'wvg_password_data', title: '密码有效期', width: 160},
                {field: 'wvg_add_time', title: '账号新增时间', width: 160},
                {field: 'wvg_update_time', title: '账号修改时间', width: 160},
                {field: 'wvg_login_time', title: '账号登录时间', width: 160},
                {field: 'wvg_login_ip', title: '账号登录IP', width: 160},
                {field: 'wvg_account_remarks', title: '说明', width: 160},
                {fixed: 'right', title: '操作', toolbar: '#operation', width: 150}]],
            url: '/users/userList?token=' +token,
            //分页
            request:{
                pageName: 'pageNum',
                limitName: 'pageSize',
                size: 10,
                page: 1
            },
            //获得服务器数据
            parseData:function(res){
                return{
                    success:true,
                    data:res.items,
                    count:res.totalNum
                };
            },
            page:{
                page:0
            },
            response: {
                statusName: 'success' //规定数据状态的字段名称，默认：code
                ,statusCode: true //规定成功的状态码，默认：0
            },
            toolbar: 'default', //让工具栏左侧显示默认的内置模板
            even: true
        });


        /*监听搜索*/
        form.on('submit(LAY-user-front-search)',function (data) {
            //获取数据
            var field =data.field;
            //执行重载
            table.reload('LAY-user-manage',{
                where:field
            });
        });

        //监听事件
        table.on('tool(LAY-user-manage)', function(obj){
            var data = obj.data; //获得当前行数据
            var layEvent = obj.event; //获得 lay-event 对应的值
            if(layEvent=='detail')
            {
                if(data.changeStr1=='离线'){
                    layer.open({
                        title: '用户不在线提示！'
                        ,content: '当前用户不在线，无法踢下线！'
                    });
                    return;
                }
                layer.confirm('确定踢出该用户下线吗？', function(index){
                    layer.close(index);
                    Offline(data.wvg_user_id);
                });
            }else if(layEvent=='edit'){
               lay.msg('编辑用户吗!');
            }
       });
    });
function Offline(wvg_user_id) {
    $.ajax({
        url:'/users/quit/'+wvg_user_id,
        success:function (data) {
            layer.msg(data.message);
        },
    })
}

</script>
</body>
</html>